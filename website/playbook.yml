---
- hosts: webserver
  become: true
  become_user: root

  tasks:
  - name: Install httpd
    yum:
      name: httpd
      state: present
  - name: start httpd
    service:
      name: httpd
      state: started
  - name: Deploy php file
    copy:
      src: content/home.php
      dest: /var/www/html
    notify: Restart httpd
  handlers:
    - name: Restart the httpd
      service:
        name: httpd
        state: restarted
  - name: Install Softwares
    yum:
      name: {{item}}
      state: present
    loop:
      - docker
      - git
  - name: Clone the repository
    git:
      repo:
        https://github.com/amarpallai/Project1.git
      dest:
          /hpme/ec2-user/proj1
  - name: Start docker
    service:
      name:
        docker
      state:
        started
  - name: Deploy the dockerfile
    command:
      chdir:
        /home/ec2-user/proj1 docker build -t myphp:1 .
  - name: Running a container
    command:
      docker run --name myphpcon -d -P myphp:1
